#
# OmniFS - A mountable file system for omnidrive.
#
# Copyright (C) 2007 Sri Panyam - http://panyam.wordpress.com
#
# All Rights Reserved.
# 
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 2.1 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY OF ANY KIND or FITNESS FOR A PARTICULAR PURPOSE.  
# See the GNU Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA
#

include Makefile.common

# 
# Main Makefile
#
.PHONY: all libs test install
all: libs test

libs:
	cd src ; make static shared

test: libs
	cd test ; make

install: 
	@cd src ; make install
	@cd test ; make install

.PHONY: clean cleanall distclean package
clean:
	@cd src ; make clean
	@cd test ; make clean

cleanall: clean
	@cd src ; make cleanall
	@cd test ; make cleanall

distclean: cleanall
	@cd src ; make distclean
	@cd test ; make distclean
	@rm -Rf Makefile Makefile.common autom4te.cache config.*

dep:
	@cd test ; make dep >& /dev/null
	@cd src ; make dep >& /dev/null

PACKAGE_NAME = lunarprobe-$(MAJOR_VERSION).$(MINOR_VERSION).$(BUILD_VERSION)
# 
# Creates the archive.
#
package:
	@rm -f /tmp/$(PACKAGE_NAME).zip /tmp/$(PACKAGE_NAME).tar.bz2 /tmp/$(PACKAGE_NAME).tar.gz
	@if [ -d /tmp/$(PACKAGE_NAME) ]; then echo "Error: Directory /tmp/$(PACKAGE_NAME) already exists." ; exit 1 ; fi
	@autoconf
	@cp -r `pwd` /tmp/$(PACKAGE_NAME)
	@rm -Rf /tmp/$(PACKAGE_NAME)/bld 
	@rm -Rf /tmp/$(PACKAGE_NAME)/Makefile /tmp/$(PACKAGE_NAME)/Makefile.common
	@rm -Rf /tmp/$(PACKAGE_NAME)/src/Makefile /tmp/$(PACKAGE_NAME)/lib/Makefile
	@rm -Rf /tmp/$(PACKAGE_NAME)/autom4te.cache /tmp/$(PACKAGE_NAME)/config.*
	@tar -C /tmp -cvf /tmp/$(PACKAGE_NAME).tar $(PACKAGE_NAME)
	@gzip /tmp/$(PACKAGE_NAME).tar
	@tar -C /tmp -cvf /tmp/$(PACKAGE_NAME).tar $(PACKAGE_NAME)
	@bzip2 /tmp/$(PACKAGE_NAME).tar
	@cd /tmp ; zip -r /tmp/$(PACKAGE_NAME).zip $(PACKAGE_NAME)
	@rm -Rf /tmp/$(PACKAGE_NAME)

help:
	@echo   "Usage: make <options> <targets>"
	@echo   "   Options:"
	@echo   "       BUILD_MODE=[debug | release]    -   Default: release"
	@echo   "       OUTPUT_DIR=<output_dir>         -   Directory to place all outputs. Default: bld"
	@echo   "       FUSE_INCLUDES=<fuse_dir>        -   Location of Fuse.  Default: /usr/local/include/fuse"
	@echo   "       CURL_INCLUDES=<curl_dir>        -   Location of Curl.  Default: /usr/local/include/curl"
	@echo   "   Targets:"
	@echo   "       all:        Builds test executable and libraries (default)"
	@echo   "       test:       Builds test executable"
	@echo   "       libs:       Builds static and shared libraries"
	@echo   "       clean:      Cleans all object files"
	@echo   "       cleanall:   Cleans all object files and executables"
	@echo   "       install:    Installs the test executable and libraries"
	@echo   "       help:       Prints help information about targets and options"
